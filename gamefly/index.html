<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=0.7,user-scalable=no" />
		<title>å¾®ä¿¡æ‰“é£æœº</title>
		<style type="text/css">
			/*reset.css*/
			/*ç”¨äºé‡ç½®htmlå…ƒç´ , é¿å…æµè§ˆå™¨é»˜è®¤çš„æ ·å¼å¯¹ç½‘é¡µçš„å½±å“, å¹¶ä¸”è¿˜å¯ä»¥æŠŠä¸€äº›å¸¸è§çš„æ“ä½œå†™è¿›æ¥, æ¯”å¦‚ä¸ºaå…ƒç´ å»æ‰ä¸‹åˆ’çº¿*/
			/*æ¯ä¸ªå…¬å¸ä¸€èˆ¬éƒ½æœ‰è‡ªå·±çš„reset.css, å¦‚æœæ²¡æœ‰å¯ä»¥é€‰ç”¨Normalize.css*/
			
			* {
				margin: 0;
				padding: 0;
			}
			/*å›¾ç‰‡ä¸‹æ–¹æœ‰ç©ºç™½çš„åŸå› : é»˜è®¤å›¾ç‰‡æ˜¯åŸºçº¿å¯¹é½*/			
			body {
				/*æ–¹å¼1*/
				/*font-size: 0;*/
			}			
			#map {
				/*æ–¹å¼2*/
				display: block;
				/*æ–¹å¼3*/
				/*vertical-align: top;*/
			}			
			#loading {
				position: absolute;
				/*top,leftåŸºäºçˆ¶è§†å›¾*/
				top: 50%;
				left: 50%;
				text-align: center;
				/*translateåŸºäºè‡ªèº«*/
				transform: translate(-50%, -50%);
			}
			
			#current-score {
				position: absolute;
				top: 0;
				left: 0;
			}
			
			#menu {
				width: 160px;
				height: 160px;
				position: absolute;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%);
				list-style-type: none;
				text-align: center;
				border: 1px solid black;
				border-radius: 5px;
				background-color: #BBC1C2;
				font-size: 20px;
				line-height: 40px;
				display: none;
			}
			
			#end-score {
				line-height: 80px;
				border-top: 1px solid black;
				border-bottom: 1px solid black;
			}
			
			#restart {
				cursor: pointer;
				/*ä¸å…è®¸ç”¨æˆ·é€‰æ‹©å½“å‰åŒºåŸŸçš„å†…å®¹*/
				-webkit-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
				user-select: none;
			}
		</style>
	</head>

	<body>
		<!--æ¸¸æˆåœ°å›¾-->
		<canvas id="map"></canvas>
		<!--åŠ è½½-->
		<div id="loading">
			<img src="img/loading.gif" />
			<p>æ¸¸æˆåŠ è½½ä¸­</p>
		</div>
		<!--åˆ†æ•°-->
		<p id="current-score">åˆ†æ•°: <span>0</span></p>
		<!--èœå•-->
		<ul id="menu">
			<li>é£æœºå¤§æˆ˜åˆ†æ•°</li>
			<li id="end-score">0</li>
			<li id="restart">é‡æ–°å¼€å§‹</li>
		</ul>

		<script type="text/javascript">
			//è·å–å…ƒç´ 
			var mapCanvas = document.getElementById("map");
			var ctx = mapCanvas.getContext("2d");
			var loadingDiv = document.getElementById("loading");
			var scoreSpan = document.querySelector("#current-score>span");
			var menuUl = document.getElementById("menu");
			var endScoreLi = document.getElementById("end-score");
			var restartLi = document.getElementById("restart");
			//è®¾ç½®canvasçš„å¤§å°å’Œæµè§ˆå™¨å¤§å°ä¿å­˜ä¸€è‡´
			//mapCanvas.width = window.innerWidth;
			//mapCanvas.height = window.innerHeight;
			mapCanvas.width = document.documentElement.clientWidth;
			mapCanvas.height = document.documentElement.clientHeight;

			//é¢„åŠ è½½: æµè§ˆå™¨å¯¹åº”ç›¸åŒçš„å›¾ç‰‡åªä¼šåŠ è½½ä¸€æ¬¡
			//ç”¨æ•°ç»„è®°å½•å›¾ç‰‡çš„åå­—, æ–¹ä¾¿å¤„ç†
			var picsnames = ["background.png", "bullet1.png", "bullet2.png", "enemy1.png", "enemy2.png", "enemy3.png", "herofly.png", "loading.gif", "prop.png"];
			var musicNames = ["bullet.mp3", "enemy1_down.mp3", "enemy2_down.mp3", "enemy3_down.mp3", "game_music.mp3", "game_over.mp3"];
			//è®°å½•å›¾ç‰‡åŠ è½½çš„å¼ æ•°
			var picCount = 0;
			//è®°å½•åŠ è½½å®Œæˆçš„éŸ³ä¹æ•°é‡
			var musicCount = 0;	
			//å­˜éŸ³ä¹å…ƒç´ 
			var musics = [];
			for(var i = 0; i < picsnames.length; i++) {
				var img = new Image();
				img.src = "img/" + picsnames[i];
				img.onload = function() {
				     picCount++;
					//åˆ¤æ–­å›¾ç‰‡æ˜¯å¦åŠ è½½å®Œæˆ
					if(picCount == picsnames.length) {
						loadMusic();
					}
				}
			}
			function loadMusic() {
				//éŸ³ä¹é¢„åŠ è½½
				for(var i = 0; i < musicNames.length; i++) {
					var music = new Audio(); //è‡ªåŠ¨é¢„åŠ è½½
					music.src = "audio/" + musicNames[i];
					musics.push(music);
					music.onloadedmetadata = function() {
						musicCount++;
						if(musicCount == musicNames.length) {
							//éšè—loadingæ ‡å¿—
							loadingDiv.style.display = "none";
							//å¼€å§‹æ¸¸æˆ
							main();
							//æ’­æ”¾èƒŒæ™¯éŸ³ä¹
							musics[4].volume = 0.5; //éŸ³é‡(0-1)
							musics[4].loop = true; //å¾ªç¯æ’­æ”¾
							musics[4].play();
						}
					}
				}
			}

			//èƒŒæ™¯å›¾
			var bgImage = new Image();
			bgImage.src = "img/background.png";
			//èƒŒæ™¯å›¾å¯¹è±¡(åªæœ‰ä¸€ä¸ª)
			var background = {
				//å±æ€§
				x: 0,
				y: 0,
				w: mapCanvas.width,
				h: mapCanvas.height,
				//æ–¹æ³•
				draw: function() {
					//å¦‚ä½•æ»¡å±, å¹¶ä¸”ä¸è°ƒæ•´å›¾ç‰‡æ¯”ä¾‹
					//1.æ±‚æœ€å¤§è¡Œå’Œæœ€å¤§åˆ—
					var row = Math.ceil(mapCanvas.height / 568);
					var col = Math.ceil(mapCanvas.width / 320);
					//2.å¾ªç¯æ·»åŠ å›¾ç‰‡
					//ä¸ºäº†ä¿è¯å›¾ç‰‡æ— é™æ»šåŠ¨, ç”»ä¸¤å¼ ä¸€æ ·çš„èƒŒæ™¯å›¾
					for(var i = -row; i < row; i++){ //è¡Œ
						for(var j = 0; j < col; j++){ //åˆ—
							ctx.drawImage(bgImage, 320 * j, 568 * i + this.y);
						}
					}
				},
				//ç§»åŠ¨
				move: function() {
					this.y++;
					//åˆ¤æ–­ä¸€å¼ å›¾ç‰‡æ»šåŠ¨å®Œæˆ, é‡ç½®ä½ç½®
					var row = Math.ceil(mapCanvas.height / 568);
					if(this.y == row * 568) {
						this.y = 0;
					}
				},
			};

			//sprite image: ç²¾çµå›¾, é›ªç¢§å›¾, é™ä½çš„æœåŠ¡å™¨çš„å‹åŠ›, æŠŠå¸¸è§çš„logo/iconæ”¾åˆ°å›¾ç‰‡ä¸­
			//æ¸¸æˆä¸­æŠŠä¸€ä¸ªç‰©ä½“çš„ä¸åŒçŠ¶æ€ä¸‹çš„å›¾ç‰‡, åšå‡ºé›ªç¢§å›¾

			//è‹±é›„å›¾ç‰‡
			var heroImg = new Image();
			heroImg.src = "img/herofly.png";
			//å­å¼¹å›¾ç‰‡
			var bulletImg1 = new Image();
			bulletImg1.src = "img/bullet1.png";
			var bulletImg2 = new Image();
			bulletImg2.src = "img/bullet2.png";

			//è‹±é›„å¯¹è±¡
			var hero = {
				//å±æ€§
				x: mapCanvas.width / 2 - 33,
				y: mapCanvas.height - 82 - 100,
				w: 66,
				h: 82,
				i: 0, //ç¬¬å‡ å¼ å›¾ç‰‡(ä»0å¼€å§‹ç®—)
				flagI: 0, //å›¾ç‰‡åˆ‡æ¢çš„é¢‘ç‡
				bullets: [], //ç”¨äºè®°å½•å‘å°„å‡ºå»çš„å­å¼¹
				flagShot: 0, //å­å¼¹å‘å°„é¢‘ç‡
				armType: 0, //æ­¦å™¨ç±»å‹(0: å•æ’; 1:åŒæ’)
				boom: false, //æ˜¯å¦çˆ†ç‚¸
				//æ–¹æ³•
				draw: function() {
					//æ§åˆ¶å›¾ç‰‡åˆ‡æ¢
					this.flagI++;
					if(this.flagI == 10) {
						if(this.boom) {
							this.i++;
							if(this.i == 5) {
								//è‹±é›„æ­»äº¡
								gameOver();
							}
						} else {
							this.i = (this.i++) % 2;
						}
						//é‡ç½®
						this.flagI = 0;
					}

					//æŠŠå›¾ç‰‡çš„æŸä¸€éƒ¨åˆ†ç”»åˆ°canvasä¸ŠæŸä¸ªåŒºåŸŸ
					ctx.drawImage( heroImg, this.i * this.w, 0, this.w, this.h, this.x, this.y, this.w, this.h);
				},
				//å‘å°„å­å¼¹
				shot: function() {
					//çˆ†ç‚¸å, ä¸èƒ½å‘å°„å­å¼¹
					if(!this.boom) {
						this.flagShot++;
					}
					if(this.flagShot == 5) {
						//æ’­æ”¾å‘å°„å­å¼¹éŸ³ä¹
						musics[0].play();
						if(this.armType) {
							//åˆ›å»ºåŒæ’å­å¼¹å¯¹è±¡
							var bullet = new Bullet(this.x + this.w / 2 - 24, this.y + 20, 48, 14, bulletImg2, 2);
						} else {
							//åˆ›å»ºå•æ’å­å¼¹å¯¹è±¡
							var bullet = new Bullet(this.x + this.w / 2 - 2, this.y - 14, 6, 14, bulletImg1, 1);
						}
						//è®°å½•å­å¼¹
						this.bullets.push(bullet);
						//é‡ç½®
						this.flagShot = 0;
					}

					//ç§»åŠ¨æ¯ä¸€é¢—å­å¼¹
					for(var i = 0; i < this.bullets.length; i++) {
						//åˆ¤æ–­å­å¼¹æ˜¯å¦è¶…å‡ºå±å¹•
						if(this.bullets[i].y <= -this.bullets[i].h) {
							//åˆ é™¤å­å¼¹
							this.bullets.splice(i, 1);
							i--;
						} else {
							//ç§»åŠ¨å­å¼¹
							this.bullets[i].move();
							this.bullets[i].draw();
						}
					}
				},
			}

			//é¼ æ ‡æ§åˆ¶è‹±é›„
			mapCanvas.onmousedown = function(event) {
					//1.é¼ æ ‡ä½ç½®
					var x = event.offsetX;
					var y = event.offsetY;
					//2.åˆ¤æ–­æ˜¯å¦é€‰ä¸­é£æœº
					if(x >= hero.x && x <= hero.x + hero.w && y >= hero.y && y <= hero.y + hero.h) {
						//é€‰ä¸­é£æœº, æ‰èƒ½ç§»åŠ¨
						mapCanvas.onmousemove = function(event) {
							//é£æœºçš„ä¸­å¿ƒåœ¨é¼ æ ‡çš„ä½ç½®
							hero.x = event.offsetX - hero.w / 2;
							hero.y = event.offsetY - hero.h / 2;
						}
					}
				}
				//æ¾å¼€é¼ æ ‡, ç§»é™¤äº‹ä»¶
			mapCanvas.onmouseup = function() {
				mapCanvas.onmousemove = null;
			}

			//è§¦æ‘¸å±çš„æ§åˆ¶
			mapCanvas.ontouchstart = function(event) {
				//1.æ‰‹æŒ‡çš„ä½ç½®
				var x = event.touches[0].clientX;
				var y = event.touches[0].clientY;
				//2.åˆ¤æ–­æ˜¯å¦é€‰ä¸­é£æœº
				if(x >= hero.x && x <= hero.x + hero.w && y >= hero.y && y <= hero.y + hero.h) {
					//é€‰ä¸­é£æœº, æ‰èƒ½ç§»åŠ¨
					mapCanvas.ontouchmove = function(event) {
						//é£æœºçš„ä¸­å¿ƒåœ¨é¼ æ ‡çš„ä½ç½®
						hero.x = event.touches[0].clientX - hero.w / 2;
						hero.y = event.touches[0].clientY - hero.h / 2;
						//ç¦æ­¢ç³»ç»Ÿäº‹ä»¶è¡Œä¸º
						event.preventDefault();
					}
				}
			}

			mapCanvas.ontouchend = function() {
				mapCanvas.ontouchmove = null;
			}

			//å­å¼¹ç±»
			function Bullet(x, y, w, h, img, hurt) {
				//å±æ€§
				this.x = x;
				this.y = y;
				this.w = w;
				this.h = h;
				this.img = img;
				this.hurt = hurt; //ä¼¤å®³
			}
			//ç»˜åˆ¶æ–¹æ³•
			Bullet.prototype.draw = function() {
					ctx.drawImage(this.img, this.x, this.y, this.w, this.h);
				}
				//ç§»åŠ¨æ–¹æ³•
			Bullet.prototype.move = function() {
				this.y -= 15;
			}

			//æ•Œäººç±»
			function Enemy(x, y, w, h, img, speed, hp, score, maxI) {
				//å±æ€§
				this.x = x;
				this.y = y;
				this.w = w;
				this.h = h;
				this.img = img;
				this.speed = speed; //é€Ÿåº¦
				this.hp = hp; //è¡€é‡
				this.score = score; //åˆ†æ•°
				this.boom = false; //æ˜¯å¦çˆ†ç‚¸
				this.i = 0; //ç¬¬å‡ å¼ å›¾ç‰‡
				this.maxI = maxI; //æ’­æ”¾çš„å›¾ç‰‡å¼ æ•°
				this.isDie = false; //æ˜¯å¦æ­»äº¡
				this.flagI = 0; //å›¾ç‰‡åˆ‡æ¢çš„é¢‘ç‡
			}
			//æ–¹æ³•
			Enemy.prototype.draw = function() {
				//çˆ†ç‚¸, åˆ‡æ¢å›¾ç‰‡
				if(this.boom) {
					this.flagI++;
				if(this.flagI == 5) {
						this.i++;
						if(this.i == this.maxI) {
							//å½“å›¾ç‰‡åˆ‡æ¢ç»“æŸ,é£æœºæ­»äº¡
							this.isDie = true;
						}
						//é‡ç½®
						this.flagI = 0;
					}
				}
				ctx.drawImage(this.img, this.i * this.w, 0, this.w, this.h, this.x, this.y, this.w, this.h);
			}
			Enemy.prototype.move = function() {
				this.y += this.speed;
			}
			//éšæœºæ•°
			function random(x, y) {
				return parseInt(Math.random() * (y - x + 1) + x);
			}
			//æ•Œæœºå›¾ç‰‡
			var enemyImg1 = new Image();
			enemyImg1.src = "img/enemy1.png";
			var enemyImg2 = new Image();
			enemyImg2.src = "img/enemy2.png";
			var enemyImg3 = new Image();
			enemyImg3.src = "img/enemy3.png";
			//è®°å½•åˆ›å»ºçš„æ•Œæœº
			var enemies = [];
			//éšæœºäº§ç”Ÿæ•Œæœº
			function randomEnemy() {
				//æ§åˆ¶é£æœºäº§ç”Ÿçš„æ¦‚ç‡
				var num = random(1, 1000);
				if(num <= 50) {
					if(num <= 40) { //å°é£æœº
						//éšæœºä½ç½®
						var randomX = random(0, mapCanvas.width - 38);
						//éšæœºé€Ÿåº¦
						var randomSpeed = random(2, 10);
						//åˆ›å»ºå°é£æœº
						var enemy = new Enemy(randomX, -34, 38, 34, enemyImg1, randomSpeed, 1, 100, 5);
						//è®°å½•é£æœº
						enemies.push(enemy);
					} else if(num <= 48) { //ä¸­å‹é£æœº
						//éšæœºä½ç½®
						var randomX = random(0, mapCanvas.width - 46);
						//éšæœºé€Ÿåº¦
						var randomSpeed = random(2, 6);
						//åˆ›å»ºä¸­å‹é£æœº
						var enemy = new Enemy(randomX, -64, 46, 64, enemyImg2, randomSpeed, 5, 500, 6);
						//è®°å½•é£æœº
						enemies.push(enemy);
					} else { //å¤§å‹é£æœº
						//éšæœºä½ç½®
						var randomX = random(0, mapCanvas.width - 110);
						//éšæœºé€Ÿåº¦
						var randomSpeed = random(2, 4);
						//åˆ›å»ºå°é£æœº
						var enemy = new Enemy(randomX, -164, 110, 164, enemyImg3, randomSpeed, 10, 1000, 10);
						//è®°å½•é£æœº
						enemies.push(enemy);
					}
				}

				//ç§»åŠ¨é£æœº
				for(var i = 0; i < enemies.length; i++) {
					//åˆ¤æ–­é£æœºæ˜¯å¦è¶…å‡ºå±å¹•
					if(enemies[i].y >= mapCanvas.height || enemies[i].isDie) {
						//åˆ é™¤é£æœº
						enemies.splice(i, 1);
						//æ•°ç»„ä¸­åˆ é™¤æŸä¸ªå…ƒç´ , ä¸ºäº†ä¿è¯ç›¸é‚»çš„ä¸‹ä¸€ä¸ªå…ƒç´ èƒ½å¤Ÿéå†åˆ°, éœ€è¦i--
						i--;
					} else {
						enemies[i].move();
						enemies[i].draw();
					}
				}
			}

			//é“å…·å›¾ç‰‡
			var propImg = new Image();
			propImg.src = "img/prop.png";
			//é“å…·ç±»
			function Prop(x, y, w, h, type, speed) {
				this.x = x;
				this.y = y;
				this.w = w;
				this.h = h;
				this.type = type; //é“å…·ç±»å‹(0:ç‚¸å¼¹, 1:åŒæ’å­å¼¹)
				this.speed = speed;
				this.isUsed = false; //é“å…·æœ‰æ²¡æœ‰è¢«ä½¿ç”¨
			}
			//æ–¹æ³•
			Prop.prototype.draw = function() {
					ctx.drawImage(propImg, this.type * this.w, 0, this.w, this.h, this.x, this.y, this.w, this.h);
				}
				//ç§»åŠ¨
			Prop.prototype.move = function() {
				this.y += this.speed;
			}

			//è®°å½•åˆ›å»ºå‡ºæ¥çš„é“å…·
			var props = [];
			//éšæœºäº§ç”Ÿé“å…·
			function randomProp() {
				//æ§åˆ¶é“å…·äº§ç”Ÿçš„æ¦‚ç‡
				if(random(1, 1000) <= 20) {
					var randomX = random(0, mapCanvas.width - 38);
					var randomType = random(0, 1);
					var randomSpeed = random(5, 10);
					var prop = new Prop(randomX, -68, 38, 68, randomType, randomSpeed);
					props.push(prop);
				}
				//ç§»åŠ¨é“å…·
				for(var i = 0; i < props.length; i++) {
					//å½“é“å…·è¶…å‡ºå±å¹•, æˆ–è€…é“å…·è¢«ä½¿ç”¨
					if(props[i].y >= mapCanvas.height || props[i].isUsed) {
						props.splice(i, 1);
						i--;
					} else {
						props[i].move();
						props[i].draw();
					}
				}
			}

			//ä¸¤ä¸ªçŸ©å½¢ç¢°æ’æ£€æµ‹
			function crash(obj1, obj2) {
				//ä¸¤ä¸ªç‰©ä½“ä¸Šä¸‹å·¦å³çš„ä½ç½®
				var left1 = obj1.x;
				var right1 = obj1.x + obj1.w;
				var top1 = obj1.y;
				var bottom1 = obj1.y + obj1.h;

				var left2 = obj2.x;
				var right2 = obj2.x + obj2.w;
				var top2 = obj2.y;
				var bottom2 = obj2.y + obj2.h;

				//åˆ¤æ–­æ˜¯å¦å‘ç”Ÿç¢°æ’
				if(right1 < left2 || bottom1 < top2 || left1 > right2 || top1 > bottom2) {
					return false;
				} else {
					return true;
				}
			}

			//è®°å½•å­å¼¹æŒç»­æ—¶é—´çš„è®¡æ—¶å™¨
			var timeout = null;
            //ç¢°æ’æ£€æµ‹
			function justify() {
				//é“å…·å’Œè‹±é›„
				for(var i = 0; i < props.length; i++) {
					if(hero.boom) {
						continue;
					}
					if(!crash(props[i], hero)) {
						continue;
					}
					//å‘ç”Ÿç¢°æ’
					if(props[i].type) { //åŒæ’å­å¼¹
						hero.armType = 1;
						//æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
						clearTimeout(timeout);
						//åŒæ’å­å¼¹æŒç»­5ç§’
						timeout = setTimeout(function() {
							hero.armType = 0;
						}, 5000);
					} else { //ç‚¸å¼¹
						//æ‰€æœ‰é£æœºçˆ†ç‚¸
						for(var j = 0; j < enemies.length; j++) {
							enemies[j].boom = true;
							//è®¡åˆ†
							scoreSpan.innerHTML = parseInt(scoreSpan.innerText) + enemies[j].score;
						}
					}
					//ä¿®æ”¹é“å…·çŠ¶æ€ä¸ºä½¿ç”¨
					props[i].isUsed = true;
				}

				//å­å¼¹(hero.bullets)å’Œæ•Œæœº(enemies)
				for(var i = 0; i < enemies.length; i++) {
					for(var j = 0; j < hero.bullets.length; j++) {
						if(enemies[i].boom) {
							break;
						}
						//æ£€æµ‹æ˜¯å¦å‘ç”Ÿç¢°æ’
						if(!crash(enemies[i], hero.bullets[j])) {
							continue;
						}
						//å‘ç”Ÿç¢°æ’ğŸ’¥
						//1.æ‰è¡€
						enemies[i].hp -= hero.bullets[j].hurt;
						//2.åˆ¤æ–­æ•Œæœºæ˜¯å¦æ­»äº¡
						if(enemies[i].hp <= 0) {
							enemies[i].boom = true;
							//è®¡åˆ†
							scoreSpan.innerHTML = parseInt(scoreSpan.innerText) + enemies[i].score;
							//åˆ¤æ–­é£æœºç±»å‹
							switch(enemies[i].score) {
								case 100:
									musics[1].play();
									break;
								case 500:
									musics[2].play();
									break;
								case 1000:
									musics[3].play();
									break;
								default:
									break;
							}
						}
						//3.å­å¼¹æ¶ˆå¤±
						hero.bullets.splice(j, 1);
						j--;
					}
				}

				//æ•Œæœºå’Œè‹±é›„
				for(var i = 0; i < enemies.length; i++) {
					//å¦‚æœæ•Œæœºå·²ç»çˆ†ç‚¸, ä¸åšç¢°æ’æ£€æµ‹
					if(enemies[i].boom) {
						continue;
					}
					if(crash(enemies[i], hero)) {
						//è‹±é›„çˆ†ç‚¸
						hero.boom = true;
					}
				}
			}

			//æ¸¸æˆä¸»ç¨‹åº
			function main() {
				//æ¸…é™¤ç”»å¸ƒå†…å®¹
				ctx.clearRect(0, 0, mapCanvas.width, mapCanvas.height);

				//ç”»èƒŒæ™¯
				background.draw();
				background.move();

				//ç”»è‹±é›„
				hero.draw();
				hero.shot();

				//ç”»æ•Œæœº
				randomEnemy();

				//ç”»é“å…·
				randomProp();

				if(!hero.boom) {
					//æ£€æµ‹
					justify();
				}

				//åŒæ­¥åˆ·æ–°
				requestAnimationFrame(main);
			}

			//ç”¨æˆ·æ”¹å˜çª—å£å¤§å°
			window.onresize = function() {
				mapCanvas.width = document.documentElement.clientWidth;
				mapCanvas.height = document.documentElement.clientHeight;
				background.draw();
			}

			//æ¸¸æˆç»“æŸ
			function gameOver() {
				//æš‚åœèƒŒæ™¯éŸ³ä¹
				musics[4].pause();
				//æ’­æ”¾æ¸¸æˆç»“æŸ
				musics[5].play();
				//ä¿®æ”¹åˆ†æ•°
				endScoreLi.innerText = scoreSpan.innerText;
				//æ˜¾ç¤ºèœå•
				menuUl.style.display = "block";
			}

			//é‡æ–°å¼€å§‹
			restartLi.onclick = function() {
				//location.reload();
				//é€šè¿‡äº§ç”Ÿä¸åŒçš„éšæœºæ•°, æ¥åˆ·æ–°ç½‘é¡µ, ä¿è¯æ¯æ¬¡åˆ·æ–°çš„urlä¸åŒ
				location.href = location.href + "?id=" + 10000 * Math.random();
			}
		</script>
	</body>

</html>